<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vivero La Laboral</title>
    <link rel="stylesheet" th:href="@{/registrarejemplar.css}">
</head>
<body>
    <header>
        <div class="logo"><img src="../imagenes/logo.png" alt="Logo"></div>
    </header>
    <main>
    <br><br>
        <h2>PLANTAS DEL VIVERO</h2>

        <div th:if="${error}" style="color: red; font-weight: bold;">
            <p th:text="${error}"></p>
        </div>
        <div th:if="${mensajeExito}" style="color: green; font-weight: bold;">
            <p th:text="${mensajeExito}"></p>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>Seleccionar</th>
                    <th>CÓDIGO DE PLANTA</th>
                    <th>NOMBRE COMÚN</th>
                    <th>NOMBRE CIENTÍFICO</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="planta : ${plantas}">
                    <td>
                        <input type="radio" name="seleccionPlanta" th:value="${planta.codigo}" onchange="activarFormulario(this)">
                    </td>
                    <td th:text="${planta.codigo}"></td>
                    <td th:text="${planta.nombrecomun}"></td>
                    <td th:text="${planta.nombrecientifico}"></td>
                    <td>
                        <!-- Corregir el th:onclick para no tener comillas internas -->
					<button id="button-selec" th:data-codigo="${planta.codigo}" onclick="mostrarFormulario(this.getAttribute('data-codigo'))">Seleccionar</button>

                    </td>
                </tr>
            </tbody>
        </table>

         <form th:action="@{/registrarejemplar}" method="post" id="formularioRegistro" style="display: none;">
            <h3>Registrar Ejemplar</h3>
            <input type="hidden" id="codPlanta" name="codPlanta" value="codPlanta" />

            <label for="mensaje">Mensaje:</label>
            <textarea id="mensaje" name="mensaje" rows="4" required></textarea>
             <div th:if="${mensajeExito}" class="mensajeExito" th:text="${mensajeExito}"></div>
            <button type="submit" id="botonRegistrar" disabled>Registrar Ejemplar</button>
        </form>

            <button onclick="window.history.back()">Volver</button>

        <br>
        <button onclick="window.history.back()">Volver al Menú</button>
    </main>

    <script>
        function activarFormulario(radio) {
            let filas = document.querySelectorAll("tbody tr");
            filas.forEach(fila => {
                let boton = fila.querySelector("button");
                if (fila.contains(radio)) {
                    boton.disabled = false;
                } else {
                    boton.disabled = true;
                }
            });
        }

        function mostrarFormulario(codigoPlanta) {
        	console.log(codigoPlanta);
            document.getElementById("formularioRegistro").style.display = "block";
            document.getElementById("codPlanta").value = codigoPlanta;
            document.querySelector("table").style.display = "none";
            document.getElementById("botonRegistrar").disabled = false;
        }
    </script>
</body>
</html>
